<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¹é£Ÿå ‚é¢åŒ…åº—</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary-color: #FF6B6B;
            --secondary-color: #4ECDC4;
            --accent-color: #FFD93D;
            --text-dark: #2C3E50;
            --text-light: #7F8C8D;
            --bg-light: #F8F9FA;
            --bg-white: #FFFFFF;
            --shadow: 0 2px 10px rgba(0,0,0,0.1);
            --shadow-hover: 0 4px 20px rgba(0,0,0,0.15);
            --border-radius: 12px;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: var(--text-dark);
        }

        .app-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        /* Header Styles */
        header {
            background: var(--bg-white);
            padding: 15px 20px;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            font-size: 24px;
            font-weight: bold;
            color: var(--primary-color);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .mode-switcher {
            display: flex;
            background: var(--bg-light);
            border-radius: 25px;
            padding: 5px;
        }

        .mode-btn {
            padding: 8px 16px;
            border: none;
            background: transparent;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 14px;
            font-weight: 500;
        }

        .mode-btn.active {
            background: var(--primary-color);
            color: white;
        }

        /* Main Content */
        main {
            flex: 1;
            background: var(--bg-white);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            padding: 20px;
            overflow-y: auto;
        }

        /* Sidebar Navigation */
        .sidebar {
            width: 250px;
            background: var(--bg-light);
            padding: 20px 0;
            border-radius: var(--border-radius);
            margin-bottom: 20px;
        }

        .nav-item {
            padding: 15px 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 10px;
            border: none;
            background: transparent;
            width: 100%;
            text-align: left;
            font-size: 15px;
            color: var(--text-dark);
        }

        .nav-item:hover {
            background: rgba(255, 107, 107, 0.1);
            padding-left: 25px;
        }

        .nav-item.active {
            background: var(--primary-color);
            color: white;
        }

        /* Content Area */
        .content {
            flex: 1;
            padding: 0 20px;
        }

        .page {
            display: none;
            animation: fadeIn 0.3s ease;
        }

        .page.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Product Grid */
        .product-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .product-card {
            background: var(--bg-white);
            border-radius: var(--border-radius);
            overflow: hidden;
            box-shadow: var(--shadow);
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .product-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-hover);
        }

        .product-image {
            width: 100%;
            height: 200px;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 48px;
        }

        .product-info {
            padding: 15px;
        }

        .product-name {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 8px;
            color: var(--text-dark);
        }

        .product-description {
            font-size: 14px;
            color: var(--text-light);
            margin-bottom: 12px;
            line-height: 1.4;
        }

        .product-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .product-price {
            font-size: 20px;
            font-weight: bold;
            color: var(--primary-color);
        }

        .add-to-cart {
            background: var(--primary-color);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 14px;
            font-weight: 500;
        }

        .add-to-cart:hover {
            background: #FF5252;
            transform: scale(1.05);
        }

        .add-to-cart:active {
            transform: scale(0.95);
        }

        /* Cart */
        .cart-container {
            background: var(--bg-light);
            border-radius: var(--border-radius);
            padding: 20px;
            margin-top: 20px;
        }

        .cart-item {
            background: var(--bg-white);
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s ease;
        }

        .cart-item:hover {
            box-shadow: var(--shadow);
        }

        .cart-item-info {
            flex: 1;
        }

        .cart-item-name {
            font-weight: 600;
            margin-bottom: 5px;
        }

        .cart-item-price {
            color: var(--text-light);
        }

        .quantity-controls {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .quantity-btn {
            width: 30px;
            height: 30px;
            border: 1px solid var(--primary-color);
            background: var(--bg-white);
            color: var(--primary-color);
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .quantity-btn:hover {
            background: var(--primary-color);
            color: white;
        }

        .cart-total {
            background: var(--bg-white);
            padding: 20px;
            border-radius: 8px;
            margin-top: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 18px;
            font-weight: 600;
        }

        .checkout-btn {
            background: var(--secondary-color);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .checkout-btn:hover {
            background: #45B7B8;
            transform: scale(1.05);
        }

        /* Order Form */
        .order-form {
            background: var(--bg-light);
            border-radius: var(--border-radius);
            padding: 20px;
            margin-top: 20px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
            color: var(--text-dark);
        }

        .form-group input,
        .form-group textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s ease;
        }

        .form-group input:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: var(--primary-color);
        }

        .submit-order-btn {
            width: 100%;
            background: var(--primary-color);
            color: white;
            border: none;
            padding: 15px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .submit-order-btn:hover {
            background: #FF5252;
        }

        /* Orders */
        .orders-container {
            margin-top: 20px;
        }

        .order-card {
            background: var(--bg-white);
            border-radius: var(--border-radius);
            padding: 20px;
            margin-bottom: 15px;
            box-shadow: var(--shadow);
            border-left: 4px solid var(--primary-color);
        }

        .order-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .order-id {
            font-weight: 600;
            color: var(--text-dark);
        }

        .order-status {
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 500;
            text-transform: uppercase;
        }

        .status-pending {
            background: #FFF3CD;
            color: #856404;
        }

        .status-processing {
            background: #CCE5FF;
            color: #004085;
        }

        .status-completed {
            background: #D4EDDA;
            color: #155724;
        }

        .status-cancelled {
            background: #F8D7DA;
            color: #721C24;
        }

        .order-items {
            margin-bottom: 10px;
        }

        .order-item {
            display: flex;
            justify-content: space-between;
            padding: 5px 0;
            border-bottom: 1px solid #f0f0f0;
        }

        .order-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 2px solid #f0f0f0;
        }

        .order-total {
            font-size: 18px;
            font-weight: 600;
            color: var(--primary-color);
        }

        .order-actions {
            display: flex;
            gap: 10px;
        }

        .action-btn {
            padding: 8px 16px;
            border: none;
            border-radius: 20px;
            cursor: pointer;
            font-size: 12px;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .action-btn.primary {
            background: var(--primary-color);
            color: white;
        }

        .action-btn.secondary {
            background: var(--bg-light);
            color: var(--text-dark);
        }

        /* Merchant Dashboard */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .stat-card {
            background: var(--bg-white);
            padding: 20px;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            text-align: center;
        }

        .stat-value {
            font-size: 24px;
            font-weight: bold;
            color: var(--primary-color);
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 14px;
            color: var(--text-light);
        }

        .product-editor {
            background: var(--bg-light);
            border-radius: var(--border-radius);
            padding: 20px;
            margin-top: 20px;
        }

        .product-form {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
        }

        /* Payment Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .modal.active {
            display: flex;
            animation: fadeIn 0.3s ease;
        }

        .modal-content {
            background: var(--bg-white);
            border-radius: var(--border-radius);
            padding: 30px;
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            position: relative;
        }

        .modal-close {
            position: absolute;
            top: 15px;
            right: 15px;
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: var(--text-light);
            transition: color 0.3s ease;
        }

        .modal-close:hover {
            color: var(--text-dark);
        }

        .payment-guide {
            text-align: center;
        }

        .payment-steps {
            background: var(--bg-light);
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }

        .payment-step {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
            gap: 10px;
        }

        .step-number {
            width: 30px;
            height: 30px;
            background: var(--primary-color);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            flex-shrink: 0;
        }

        .payment-qr {
            background: var(--bg-light);
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
            text-align: center;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .app-container {
                padding: 10px;
                min-height: 100vh;
            }

            header {
                flex-direction: column;
                gap: 15px;
                padding: 15px;
            }

            .logo {
                font-size: 20px;
            }

            .main-content {
                display: block !important;
            }

            .sidebar {
                width: 100%;
                display: flex;
                overflow-x: auto;
                padding: 10px 0;
                margin-bottom: 15px;
            }

            .nav-item {
                white-space: nowrap;
                padding: 8px 12px;
                font-size: 13px;
                min-width: fit-content;
            }

            .content {
                padding: 0;
            }

            .product-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 10px;
            }

            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 10px;
            }

            .stat-card {
                padding: 15px;
            }

            .stat-value {
                font-size: 20px;
            }

            .product-card {
                margin-bottom: 10px;
            }

            .product-image {
                height: 120px;
                font-size: 36px;
            }

            .product-info {
                padding: 10px;
            }

            .product-name {
                font-size: 16px;
            }

            .product-price {
                font-size: 18px;
            }

            .modal-content {
                margin: 20px;
                padding: 20px;
                max-height: 90vh;
            }
        }

        @media (max-width: 480px) {
            .app-container {
                padding: 5px;
            }

            header {
                padding: 10px;
            }

            .logo {
                font-size: 18px;
            }

            .mode-btn {
                padding: 6px 12px;
                font-size: 12px;
            }

            .product-grid {
                grid-template-columns: 1fr;
                gap: 10px;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .stat-card {
                padding: 12px;
            }

            .product-image {
                height: 150px;
                font-size: 42px;
            }

            .cart-item {
                padding: 10px;
                font-size: 14px;
            }

            .order-card {
                padding: 15px;
                margin-bottom: 10px;
            }

            .modal-content {
                margin: 10px;
                padding: 15px;
            }

            .payment-steps {
                padding: 15px;
            }

            .payment-step {
                margin-bottom: 10px;
            }
        }

        /* Loading and Empty States */
        .loading {
            text-align: center;
            padding: 40px;
            color: var(--text-light);
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: var(--text-light);
        }

        .empty-state h3 {
            margin-bottom: 10px;
            color: var(--text-dark);
        }

        /* Animations */
        @keyframes slideIn {
            from { transform: translateX(-100%); }
            to { transform: translateX(0); }
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        .pulse {
            animation: pulse 2s infinite;
        }

        /* æ•°æ®åˆ†æä¸“ç”¨æ ·å¼ */
        .chart-container {
            background: var(--bg-white);
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
        }

        .progress-bar {
            background: var(--bg-light);
            height: 20px;
            border-radius: 10px;
            overflow: hidden;
            position: relative;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
            border-radius: 10px;
            transition: width 0.8s ease;
            position: relative;
            overflow: hidden;
        }

        .progress-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            animation: shimmer 2s infinite;
        }

        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        .stat-card-animated {
            background: var(--bg-white);
            border-radius: var(--border-radius);
            padding: 20px;
            box-shadow: var(--shadow);
            text-align: center;
            position: relative;
            overflow: hidden;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .stat-card-animated:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-hover);
        }

        .stat-card-animated::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, transparent, rgba(255,255,255,0.1), transparent);
            transform: rotate(45deg);
            transition: all 0.5s ease;
        }

        .stat-card-animated:hover::before {
            animation: shine 0.5s ease;
        }

        @keyframes shine {
            0% { transform: translateX(-100%) translateY(-100%) rotate(45deg); }
            100% { transform: translateX(100%) translateY(100%) rotate(45deg); }
        }

        .data-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            background: var(--bg-white);
            border-radius: 8px;
            margin-bottom: 8px;
            border-left: 4px solid transparent;
            transition: all 0.3s ease;
        }

        .data-row:hover {
            border-left-color: var(--primary-color);
            transform: translateX(5px);
            box-shadow: var(--shadow);
        }

        .badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: bold;
            text-transform: uppercase;
        }

        .badge-success {
            background: #d4edda;
            color: #155724;
        }

        .badge-warning {
            background: #fff3cd;
            color: #856404;
        }

        .badge-danger {
            background: #f8d7da;
            color: #721c24;
        }

        .chart-bar {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
        }

        .chart-label {
            flex: 0 0 120px;
            font-size: 14px;
            color: var(--text-dark);
            font-weight: 500;
        }

        .chart-bar-container {
            flex: 1;
            height: 24px;
            background: var(--bg-light);
            border-radius: 12px;
            overflow: hidden;
            margin: 0 10px;
        }

        .chart-bar-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
            border-radius: 12px;
            transition: width 0.8s ease;
            display: flex;
            align-items: center;
            justify-content: flex-end;
            padding-right: 8px;
            color: white;
            font-size: 12px;
            font-weight: bold;
        }

        .chart-value {
            flex: 0 0 80px;
            text-align: right;
            font-weight: bold;
            color: var(--primary-color);
        }

        /* å“åº”å¼å›¾è¡¨ */
        @media (max-width: 768px) {
            .chart-label {
                flex: 0 0 80px;
                font-size: 12px;
            }
            .chart-value {
                flex: 0 0 60px;
                font-size: 12px;
            }
        }

        /* å®æ—¶æ•°æ®åŠ¨ç”» */
        @keyframes dataUpdate {
            0% { 
                background-color: rgba(78, 205, 196, 0.2);
                transform: scale(1.05);
            }
            100% { 
                background-color: transparent;
                transform: scale(1);
            }
        }

        .data-updating {
            animation: dataUpdate 0.5s ease;
        }
    </style>
</head>
<body>
    <div class="app-container">
        <header>
            <div class="logo">
                <span>ğŸ¥</span>
                <span>ä¹é£Ÿå ‚é¢åŒ…åº—</span>
            </div>
            <div class="mode-switcher">
                <button class="mode-btn active" onclick="app.switchMode('user')">ç”¨æˆ·ç«¯</button>
                <button class="mode-btn" onclick="app.switchMode('merchant')">å•†å®¶ç«¯</button>
            </div>
        </header>

        <main class="main-content">
            <!-- ç”¨æˆ·ç«¯ -->
            <div id="userMode" class="mode-content">
                <div style="display: flex; gap: 20px;">
                    <!-- ç”¨æˆ·ä¾§è¾¹æ  -->
                    <aside class="sidebar">
                        <button class="nav-item active" onclick="app.showPage('products')">
                            <span>ğŸ›ï¸</span> å•†å“åˆ—è¡¨
                        </button>
                        <button class="nav-item" onclick="app.showPage('cart')">
                            <span>ğŸ›’</span> è´­ç‰©è½¦
                            <span id="cartCount" style="background: var(--primary-color); color: white; border-radius: 50%; padding: 2px 6px; font-size: 12px;">0</span>
                        </button>
                        <button class="nav-item" onclick="app.showPage('orders')">
                            <span>ğŸ“‹</span> æˆ‘çš„è®¢å•
                        </button>
                        <button class="nav-item" onclick="app.showPage('profile')">
                            <span>ğŸ‘¤</span> ä¸ªäººä¸­å¿ƒ
                        </button>
                    </aside>

                    <!-- ç”¨æˆ·å†…å®¹åŒº -->
                    <div class="content">
                        <!-- å•†å“é¡µé¢ -->
                        <div id="productsPage" class="page active">
                            <h2>æ–°é²œé¢åŒ…</h2>
                            <div class="product-grid" id="productGrid">
                                <!-- å•†å“å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                            </div>
                        </div>

                        <!-- è´­ç‰©è½¦é¡µé¢ -->
                        <div id="cartPage" class="page">
                            <h2>è´­ç‰©è½¦</h2>
                            <div class="cart-container" id="cartContainer">
                                <!-- è´­ç‰©è½¦é¡¹ç›®å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                            </div>
                        </div>

                        <!-- è®¢å•é¡µé¢ -->
                        <div id="ordersPage" class="page">
                            <h2>æˆ‘çš„è®¢å•</h2>
                            <div class="orders-container" id="ordersContainer">
                                <!-- è®¢å•å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                            </div>
                        </div>

                        <!-- ä¸ªäººä¸­å¿ƒé¡µé¢ -->
                        <div id="profilePage" class="page">
                            <h2>ä¸ªäººä¸­å¿ƒ</h2>
                            <div class="order-form">
                                <h3 style="margin-bottom: 20px;">æ”¶è´§åœ°å€</h3>
                                <div class="form-group">
                                    <label>å§“å</label>
                                    <input type="text" id="profileName" placeholder="è¯·è¾“å…¥å§“å">
                                </div>
                                <div class="form-group">
                                    <label>ç”µè¯</label>
                                    <input type="tel" id="profilePhone" placeholder="è¯·è¾“å…¥ç”µè¯">
                                </div>
                                <div class="form-group">
                                    <label>åœ°å€</label>
                                    <textarea id="profileAddress" rows="3" placeholder="è¯·è¾“å…¥è¯¦ç»†åœ°å€"></textarea>
                                </div>
                                <button class="submit-order-btn" onclick="app.saveProfile()">ä¿å­˜ä¿¡æ¯</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- å•†å®¶ç«¯ -->
            <div id="merchantMode" class="mode-content" style="display: none;">
                <div style="display: flex; gap: 20px;">
                    <!-- å•†å®¶ä¾§è¾¹æ  -->
                    <aside class="sidebar">
                        <button class="nav-item active" onclick="app.showMerchantPage('dashboard')">
                            <span>ğŸ“Š</span> æ•°æ®ç»Ÿè®¡
                        </button>
                        <button class="nav-item" onclick="app.showMerchantPage('ordersManage')">
                            <span>ğŸ“‹</span> è®¢å•ç®¡ç†
                        </button>
                        <button class="nav-item" onclick="app.showMerchantPage('productsManage')">
                            <span>ğŸ›ï¸</span> å•†å“ç®¡ç†
                        </button>
                        <button class="nav-item" onclick="app.showMerchantPage('analytics')">
                            <span>ğŸ“ˆ</span> é”€å”®åˆ†æ
                        </button>
                    </aside>

                    <!-- å•†å®¶å†…å®¹åŒº -->
                    <div class="content">
                        <!-- ç»Ÿè®¡é¢æ¿ -->
                        <div id="dashboardPage" class="page active">
                            <h2>æ•°æ®ç»Ÿè®¡</h2>
                            <div class="stats-grid">
                                <div class="stat-card">
                                    <div class="stat-value" id="totalOrders">0</div>
                                    <div class="stat-label">æ€»è®¢å•æ•°</div>
                                </div>
                                <div class="stat-card">
                                    <div class="stat-value" id="totalRevenue">Â¥0</div>
                                    <div class="stat-label">æ€»æ”¶å…¥</div>
                                </div>
                                <div class="stat-card">
                                    <div class="stat-value" id="todayOrders">0</div>
                                    <div class="stat-label">ä»Šæ—¥è®¢å•</div>
                                </div>
                                <div class="stat-card">
                                    <div class="stat-value" id="pendingOrders">0</div>
                                    <div class="stat-label">å¾…å¤„ç†è®¢å•</div>
                                </div>
                            </div>
                            <div class="order-form">
                                <h3>çƒ­é”€å•†å“æ’è¡Œ</h3>
                                <div id="hotProducts">
                                    <!-- çƒ­é”€å•†å“å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                                </div>
                            </div>
                        </div>

                        <!-- è®¢å•ç®¡ç† -->
                        <div id="ordersManagePage" class="page">
                            <h2>è®¢å•ç®¡ç†</h2>
                            <div class="orders-container" id="merchantOrdersContainer">
                                <!-- è®¢å•å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                            </div>
                        </div>

                        <!-- å•†å“ç®¡ç† -->
                        <div id="productsManagePage" class="page">
                            <h2>å•†å“ç®¡ç†</h2>
                            <div class="product-editor">
                                <div class="product-form" id="productForm">
                                    <!-- å•†å“ç¼–è¾‘è¡¨å•å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                                </div>
                            </div>
                        </div>

        <!-- é”€å”®åˆ†æ -->
        <div id="analyticsPage" class="page">
            <h2>ğŸ“Š é”€å”®åˆ†æ</h2>
            
            <!-- å®æ—¶æ•°æ®æ¦‚è§ˆ -->
            <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 25px; border-radius: 12px; margin-bottom: 25px; position: relative; overflow: hidden;">
                <div style="position: absolute; top: -50px; right: -50px; width: 150px; height: 150px; background: rgba(255,255,255,0.1); border-radius: 50%;"></div>
                <div style="position: absolute; bottom: -30px; left: -30px; width: 100px; height: 100px; background: rgba(255,255,255,0.1); border-radius: 50%;"></div>
                
                <h3 style="margin-bottom: 20px; position: relative;">ğŸ“ˆ å®æ—¶ä¸šåŠ¡æ¦‚è§ˆ</h3>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 20px; position: relative;">
                    <div style="text-align: center; padding: 20px; background: rgba(255,255,255,0.15); border-radius: 12px; backdrop-filter: blur(10px);">
                        <div style="font-size: 32px; font-weight: bold; margin-bottom: 8px;" id="liveTotalRevenue">Â¥0</div>
                        <div style="font-size: 14px; opacity: 0.9;">æ€»æ”¶å…¥</div>
                        <div style="font-size: 12px; opacity: 0.7; margin-top: 5px;" id="revenueGrowth">+0%</div>
                    </div>
                    <div style="text-align: center; padding: 20px; background: rgba(255,255,255,0.15); border-radius: 12px; backdrop-filter: blur(10px);">
                        <div style="font-size: 32px; font-weight: bold; margin-bottom: 8px;" id="liveTotalItemsSold">0</div>
                        <div style="font-size: 14px; opacity: 0.9;">å•†å“é”€é‡</div>
                        <div style="font-size: 12px; opacity: 0.7; margin-top: 5px;" id="salesGrowth">+0%</div>
                    </div>
                    <div style="text-align: center; padding: 20px; background: rgba(255,255,255,0.15); border-radius: 12px; backdrop-filter: blur(10px);">
                        <div style="font-size: 32px; font-weight: bold; margin-bottom: 8px;" id="liveAvgOrderValue">Â¥0</div>
                        <div style="font-size: 14px; opacity: 0.9;">å¹³å‡è®¢å•</div>
                        <div style="font-size: 12px; opacity: 0.7; margin-top: 5px;" id="avgOrderGrowth">+0%</div>
                    </div>
                    <div style="text-align: center; padding: 20px; background: rgba(255,255,255,0.15); border-radius: 12px; backdrop-filter: blur(10px);">
                        <div style="font-size: 32px; font-weight: bold; margin-bottom: 8px;" id="liveConversionRate">0%</div>
                        <div style="font-size: 14px; opacity: 0.9;">å®Œæˆç‡</div>
                        <div style="font-size: 12px; opacity: 0.7; margin-top: 5px;" id="conversionGrowth">+0%</div>
                    </div>
                </div>
            </div>

            <!-- å®¢æˆ·åˆ†æé¢æ¿ -->
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 25px;">
                <div class="order-form" style="background: linear-gradient(135deg, #FF6B6B, #FF8E8E);">
                    <h3 style="color: white; margin-bottom: 20px;">ğŸ‘¥ å®¢æˆ·åˆ†æ</h3>
                    <div style="background: rgba(255,255,255,0.95); padding: 20px; border-radius: 10px;">
                        <div id="customerAnalytics" style="min-height: 200px;">
                            <!-- å®¢æˆ·åˆ†ææ•°æ® -->
                        </div>
                    </div>
                </div>
                
                <div class="order-form" style="background: linear-gradient(135deg, #4ECDC4, #6FE5DD);">
                    <h3 style="color: white; margin-bottom: 20px;">ğŸ•’ æ—¶é—´åˆ†æ</h3>
                    <div style="background: rgba(255,255,255,0.95); padding: 20px; border-radius: 10px;">
                        <div id="timeAnalytics" style="min-height: 200px;">
                            <!-- æ—¶é—´åˆ†ææ•°æ® -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- é”€å”®è¶‹åŠ¿å›¾è¡¨ -->
            <div style="display: grid; grid-template-columns: 2fr 1fr; gap: 20px; margin-bottom: 25px;">
                <div class="order-form">
                    <h3>ğŸ“Š å•†å“é”€é‡æ’è¡Œ</h3>
                    <div id="productSalesChart" style="margin-top: 15px; min-height: 300px;">
                        <!-- å•†å“é”€é‡å›¾è¡¨ -->
                    </div>
                </div>
                
                <div class="order-form">
                    <h3>ğŸ“ˆ æ¯æ—¥é”€å”®è¶‹åŠ¿</h3>
                    <div id="dailySalesChart" style="margin-top: 15px; min-height: 300px;">
                        <!-- æ¯æ—¥é”€å”®å›¾è¡¨ -->
                    </div>
                </div>
            </div>

            <!-- çƒ­é—¨æ—¶æ®µå’Œå•†å“ç»„åˆ -->
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 25px;">
                <div class="order-form">
                    <h3>ğŸ• çƒ­é—¨ä¸‹å•æ—¶æ®µ</h3>
                    <div id="peakHoursChart" style="margin-top: 15px;">
                        <!-- é«˜å³°æ—¶æ®µå›¾è¡¨ -->
                    </div>
                </div>
                
                <div class="order-form">
                    <h3>ğŸ›’ å•†å“ç»„åˆåˆ†æ</h3>
                    <div id="productCombination" style="margin-top: 15px;">
                        <!-- å•†å“ç»„åˆåˆ†æ -->
                    </div>
                </div>
            </div>

            <!-- è¯¦ç»†é”€å”®æ•°æ®è¡¨æ ¼ -->
            <div class="order-form">
                <h3>ğŸ“‹ è¯¦ç»†é”€å”®æ•°æ®</h3>
                <div id="detailedSalesData" style="margin-top: 15px;">
                    <!-- è¯¦ç»†æ•°æ®è¡¨æ ¼ -->
                </div>
            </div>
        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- æ”¯ä»˜å¼•å¯¼æ¨¡æ€æ¡† -->
    <div id="paymentModal" class="modal">
        <div class="modal-content">
            <button class="modal-close" onclick="app.closePaymentModal()">Ã—</button>
            <div class="payment-guide">
                <h2>ğŸ’° æ”¯ä»˜å¼•å¯¼</h2>
                <p style="margin-bottom: 20px;">è¯·æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤å®Œæˆæ”¯ä»˜ï¼š</p>
                
                <div class="payment-steps">
                    <div class="payment-step">
                        <div class="step-number">1</div>
                        <div>æˆªå›¾ä¿å­˜è®¢å•å·</div>
                    </div>
                    <div class="payment-step">
                        <div class="step-number">2</div>
                        <div>è”ç³»å•†å®¶å¾®ä¿¡è½¬è´¦</div>
                    </div>
                    <div class="payment-step">
                        <div class="step-number">3</div>
                        <div>è½¬è´¦å¯¹åº”é‡‘é¢</div>
                    </div>
                    <div class="payment-step">
                        <div class="step-number">4</div>
                        <div>å¤‡æ³¨è®¢å•å·å6ä½</div>
                    </div>
                </div>

                <div class="payment-qr">
                    <h3>è®¢å•ä¿¡æ¯</h3>
                    <p><strong>è®¢å•å·ï¼š</strong><span id="orderNumber"></span></p>
                    <p><strong>æ”¯ä»˜é‡‘é¢ï¼š</strong><span id="paymentAmount"></span></p>
                    <div style="background: #fff3cd; padding: 20px; border-radius: 8px; margin: 20px 0;">
                        <h4 style="color: #856404; margin-bottom: 10px;">ğŸ’° æ”¯ä»˜æ–¹å¼</h4>
                        <p style="color: #856404; margin-bottom: 15px;">è¯·è”ç³»å•†å®¶å¾®ä¿¡å®Œæˆè½¬è´¦æ”¯ä»˜</p>
                        <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; border-left: 4px solid #FF6B6B;">
                            <p style="font-size: 16px; font-weight: 600; color: #2C3E50; margin-bottom: 10px;">ğŸ“ å•†å®¶è”ç³»æ–¹å¼</p>
                            <p style="color: #7F8C8D;">è¯·é€šè¿‡å¾®ä¿¡è”ç³»å•†å®¶è¿›è¡Œè½¬è´¦æ”¯ä»˜</p>
                        </div>
                    </div>
                </div>

                <div style="background: #d4edda; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                    <p style="color: #155724; font-size: 14px; text-align: center;">
                        âœ… <strong>æ”¯ä»˜å®Œæˆåç‚¹å‡»ä¸‹æ–¹æŒ‰é’®ï¼Œæ‚¨çš„è®¢å•å°†ç«‹å³ç”Ÿæ•ˆï¼</strong>
                    </p>
                </div>

                <div style="display: flex; gap: 10px;">
                    <button class="action-btn secondary" style="flex: 1;" onclick="app.closePaymentModal()">å–æ¶ˆ</button>
                    <button class="action-btn primary" style="flex: 1;" onclick="app.confirmPayment()">æ”¯ä»˜å®Œæˆ</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // åº”ç”¨çŠ¶æ€ç®¡ç†
        const app = {
            // å•†å“æ•°æ®
            products: [
                { id: 1, name: 'è´æœ', description: 'åœ†ç¯å½¢é¢åŒ…ï¼Œå£æ„ŸQå¼¹ï¼Œæœ‰åš¼åŠ²', price: 5, emoji: 'ğŸ¥¯', category: 'classic', stock: 30 },
                { id: 2, name: 'åå¸', description: 'æŸ”è½¯ç»†è…»ï¼Œé€‚åˆä¸‰æ˜æ²»ï¼Œæ—©é¤é¦–é€‰', price: 10, emoji: 'ğŸ', category: 'classic', stock: 10 },
                { id: 3, name: 'å°åœ†é¢åŒ…', description: 'å°å·§å¯çˆ±ï¼Œæ¾è½¯é¦™ç”œï¼Œé€‚åˆå°æœ‹å‹', price: 5, emoji: 'ğŸ¥–', category: 'classic', stock: 20 },
                { id: 4, name: 'å½©è‰²é¢åŒ…', description: 'å¤©ç„¶è‰²ç´ åˆ¶ä½œï¼Œè‰²å½©ç¼¤çº·ï¼Œé¢œå€¼æ»¡åˆ†', price: 6, emoji: 'ğŸŒˆ', category: 'creative', stock: 15 },
                { id: 5, name: 'æ³•æ£', description: 'ä¼ ç»Ÿæ³•å¼é•¿æ£ï¼Œå¤–è„†å†…è½¯ï¼Œç»å…¸ç™¾æ­', price: 8, emoji: 'ğŸ¥–', category: 'french', stock: 7 },
                { id: 6, name: 'ç‰›è§’åŒ…', description: 'å±‚æ¬¡åˆ†æ˜ï¼Œé»„æ²¹é¦™æ°”ï¼Œé…¥è„†å¯å£', price: 6, emoji: 'ğŸ¥', category: 'french', stock: 15 },
                { id: 7, name: 'è èåŒ…', description: 'é…¥çš®é¦™ç”œï¼Œæ¾è½¯ç»†è…»ï¼Œæ¸¯å¼ç»å…¸', price: 9, emoji: 'ğŸ', category: 'hongkong', stock: 10 },
                { id: 8, name: 'ç”œç”œåœˆ', description: 'ç¯å½¢ç”œç”œåœˆï¼Œç³–éœœè£…é¥°ï¼Œç”œè€Œä¸è…»', price: 7, emoji: 'ğŸ©', category: 'american', stock: 10 },
                { id: 9, name: 'çƒ­ç‹—é¢åŒ…', description: 'æ¾è½¯é¢åŒ…èƒšï¼Œæ­é…é¦™è‚ ï¼Œç¾å‘³ä¸»é£Ÿ', price: 11, emoji: 'ğŸŒ­', category: 'main', stock: 10 }
            ],

            // è´­ç‰©è½¦
            cart: [],
            
            // è®¢å•
            orders: [],
            
            // ç”¨æˆ·ä¿¡æ¯
            profile: {
                name: '',
                phone: '',
                address: ''
            },

            // å½“å‰æ¨¡å¼
            currentMode: 'user',
            
            // å½“å‰é¡µé¢
            currentPage: 'products',
            currentMerchantPage: 'dashboard',

            // åˆå§‹åŒ–åº”ç”¨
            init() {
                this.loadFromStorage();
                
                // å¦‚æœæ²¡æœ‰è®¢å•æ•°æ®ï¼Œåˆ›å»ºä¸€ä¸ªæµ‹è¯•è®¢å•
                if (this.orders.length === 0) {
                    console.log('æ²¡æœ‰è®¢å•æ•°æ®ï¼Œåˆ›å»ºé»˜è®¤æµ‹è¯•è®¢å•');
                    this.createDefaultTestOrder();
                }
                
                this.renderProducts();
                this.renderCart();
                this.renderOrders();
                this.updateStats();
                this.loadProfile();
                
                // ç«‹å³åˆå§‹åŒ–å•†å®¶ç«¯
                setTimeout(() => {
                    console.log('åˆå§‹åŒ–å•†å®¶ç«¯ï¼Œå½“å‰è®¢å•æ•°é‡:', this.orders.length);
                    this.renderMerchantOrders();
                }, 100);
            },

            // ä»æœ¬åœ°å­˜å‚¨åŠ è½½æ•°æ®
            loadFromStorage() {
                const cart = localStorage.getItem('bakery_cart');
                const orders = localStorage.getItem('bakery_orders');
                const profile = localStorage.getItem('bakery_profile');
                const products = localStorage.getItem('bakery_products');

                if (cart) this.cart = JSON.parse(cart);
                if (orders) this.orders = JSON.parse(orders);
                if (profile) this.profile = JSON.parse(profile);
                if (products) this.products = JSON.parse(products);
            },

            // ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨
            saveToStorage() {
                localStorage.setItem('bakery_cart', JSON.stringify(this.cart));
                localStorage.setItem('bakery_orders', JSON.stringify(this.orders));
                localStorage.setItem('bakery_profile', JSON.stringify(this.profile));
                localStorage.setItem('bakery_products', JSON.stringify(this.products));
            },

            // åˆ‡æ¢æ¨¡å¼
            switchMode(mode) {
                this.currentMode = mode;
                
                // æ›´æ–°æ¨¡å¼æŒ‰é’®
                document.querySelectorAll('.mode-btn').forEach(btn => {
                    btn.classList.remove('active');
                });
                event.target.classList.add('active');

                // åˆ‡æ¢å†…å®¹æ˜¾ç¤º
                if (mode === 'user') {
                    document.getElementById('userMode').style.display = 'flex';
                    document.getElementById('merchantMode').style.display = 'none';
                } else {
                    document.getElementById('userMode').style.display = 'none';
                    document.getElementById('merchantMode').style.display = 'flex';
                    
                    // å»¶è¿Ÿæ¸²æŸ“ç¡®ä¿DOMå®Œå…¨åŠ è½½
                    setTimeout(() => {
                        // é‡æ–°åŠ è½½æ•°æ®ç¡®ä¿åŒæ­¥
                        this.loadFromStorage();
                        this.updateStats();
                        this.renderMerchantOrders();
                        
                        console.log('åˆ‡æ¢åˆ°å•†å®¶ç«¯ï¼Œå½“å‰è®¢å•æ•°é‡:', this.orders.length);
                    }, 100);
                }
            },

            // æ˜¾ç¤ºé¡µé¢
            showPage(pageName) {
                // æ›´æ–°å¯¼èˆªçŠ¶æ€
                document.querySelectorAll('#userMode .nav-item').forEach(item => {
                    item.classList.remove('active');
                });
                event.target.classList.add('active');

                // åˆ‡æ¢é¡µé¢
                document.querySelectorAll('#userMode .page').forEach(page => {
                    page.classList.remove('active');
                });
                document.getElementById(pageName + 'Page').classList.add('active');

                // æ›´æ–°é¡µé¢å†…å®¹
                this.currentPage = pageName;
                this.updatePageContent(pageName);
            },

            // æ˜¾ç¤ºå•†å®¶é¡µé¢
            showMerchantPage(pageName) {
                // æ›´æ–°å¯¼èˆªçŠ¶æ€
                const merchantNavItems = document.querySelectorAll('#merchantMode .nav-item');
                merchantNavItems.forEach(item => {
                    item.classList.remove('active');
                });
                if (event && event.target) {
                    event.target.classList.add('active');
                } else {
                    // å¦‚æœæ²¡æœ‰eventï¼Œæ‰‹åŠ¨æ‰¾åˆ°å¯¹åº”çš„æŒ‰é’®å¹¶æ¿€æ´»
                    const targetButton = Array.from(merchantNavItems).find(item => 
                        item.getAttribute('onclick') && item.getAttribute('onclick').includes(pageName)
                    );
                    if (targetButton) targetButton.classList.add('active');
                }

                // åˆ‡æ¢é¡µé¢
                document.querySelectorAll('#merchantMode .page').forEach(page => {
                    page.classList.remove('active');
                });
                const targetPage = document.getElementById(pageName + 'Page');
                if (targetPage) {
                    targetPage.classList.add('active');
                }

                // æ›´æ–°é¡µé¢å†…å®¹
                this.currentMerchantPage = pageName;
                this.updateMerchantPageContent(pageName);
            },

            // æ›´æ–°é¡µé¢å†…å®¹
            updatePageContent(pageName) {
                switch (pageName) {
                    case 'products':
                        this.renderProducts();
                        break;
                    case 'cart':
                        this.renderCart();
                        break;
                    case 'orders':
                        this.renderOrders();
                        break;
                    case 'profile':
                        this.loadProfile();
                        break;
                }
            },

            // æ›´æ–°å•†å®¶é¡µé¢å†…å®¹
            updateMerchantPageContent(pageName) {
                console.log('åˆ‡æ¢åˆ°å•†å®¶é¡µé¢:', pageName);
                
                switch (pageName) {
                    case 'dashboard':
                        this.updateStats();
                        break;
                    case 'ordersManage':
                        this.renderMerchantOrders();
                        break;
                    case 'productsManage':
                        this.renderProductManagement();
                        break;
                    case 'analytics':
                        this.renderAnalytics();
                        break;
                }
            },

            // æ¸²æŸ“å•†å“åˆ—è¡¨
            renderProducts() {
                const productGrid = document.getElementById('productGrid');
                if (!productGrid) return;

                productGrid.innerHTML = '';
                
                this.products.forEach(product => {
                    const productCard = document.createElement('div');
                    productCard.className = 'product-card';
                    productCard.innerHTML = `
                        <div class="product-image">${product.emoji}</div>
                        <div class="product-info">
                            <div class="product-name">${product.name}</div>
                            <div class="product-description">${product.description}</div>
                            <div class="product-footer">
                                <div class="product-price">Â¥${product.price}</div>
                                <button class="add-to-cart" onclick="app.addToCart(${product.id})">
                                    åŠ å…¥è´­ç‰©è½¦
                                </button>
                            </div>
                        </div>
                    `;
                    productGrid.appendChild(productCard);
                });
            },

            // æ·»åŠ åˆ°è´­ç‰©è½¦
            addToCart(productId) {
                const product = this.products.find(p => p.id === productId);
                if (!product) return;

                const existingItem = this.cart.find(item => item.id === productId);
                if (existingItem) {
                    existingItem.quantity++;
                } else {
                    this.cart.push({
                        ...product,
                        quantity: 1
                    });
                }

                this.saveToStorage();
                this.updateCartCount();
                
                // æ·»åŠ åŠ¨ç”»æ•ˆæœ
                const button = event.target;
                button.classList.add('pulse');
                setTimeout(() => button.classList.remove('pulse'), 500);

                // æ˜¾ç¤ºæç¤º
                this.showNotification('å·²æ·»åŠ åˆ°è´­ç‰©è½¦');
            },

            // æ¸²æŸ“è´­ç‰©è½¦
            renderCart() {
                const cartContainer = document.getElementById('cartContainer');
                if (!cartContainer) return;

                if (this.cart.length === 0) {
                    cartContainer.innerHTML = `
                        <div class="empty-state">
                            <h3>è´­ç‰©è½¦æ˜¯ç©ºçš„</h3>
                            <p>å¿«å»é€‰è´­ç¾å‘³çš„é¢åŒ…å§ï¼</p>
                        </div>
                    `;
                    return;
                }

                let cartHTML = '';
                let total = 0;

                this.cart.forEach((item, index) => {
                    const itemTotal = item.price * item.quantity;
                    total += itemTotal;

                    cartHTML += `
                        <div class="cart-item">
                            <div class="cart-item-info">
                                <div class="cart-item-name">${item.name}</div>
                                <div class="cart-item-price">Â¥${item.price} Ã— ${item.quantity}</div>
                            </div>
                            <div class="quantity-controls">
                                <button class="quantity-btn" onclick="app.updateQuantity(${index}, -1)">-</button>
                                <span>${item.quantity}</span>
                                <button class="quantity-btn" onclick="app.updateQuantity(${index}, 1)">+</button>
                            </div>
                        </div>
                    `;
                });

                cartHTML += `
                    <div class="cart-total">
                        <span>æ€»è®¡ï¼šÂ¥${total}</span>
                        <button class="checkout-btn" onclick="app.proceedToCheckout()">
                            å»ç»“ç®— (${this.cart.length}ä»¶)
                        </button>
                    </div>
                `;

                cartContainer.innerHTML = cartHTML;
            },

            // æ›´æ–°å•†å“æ•°é‡
            updateQuantity(index, change) {
                const item = this.cart[index];
                item.quantity += change;

                if (item.quantity <= 0) {
                    this.cart.splice(index, 1);
                }

                this.saveToStorage();
                this.renderCart();
                this.updateCartCount();
            },

            // æ›´æ–°è´­ç‰©è½¦æ•°é‡
            updateCartCount() {
                const count = this.cart.reduce((sum, item) => sum + item.quantity, 0);
                const cartCount = document.getElementById('cartCount');
                if (cartCount) {
                    cartCount.textContent = count;
                }
            },

            // å»ç»“ç®—
            proceedToCheckout() {
                if (this.cart.length === 0) {
                    this.showNotification('è´­ç‰©è½¦æ˜¯ç©ºçš„', 'error');
                    return;
                }

                // åˆ‡æ¢åˆ°ä¸ªäººä¸­å¿ƒé¡µé¢å¡«å†™åœ°å€
                this.showPage('profile');
                
                // æ›´æ–°å¯¼èˆª
                document.querySelectorAll('#userMode .nav-item').forEach(item => {
                    item.classList.remove('active');
                });
                document.querySelector('#userMode .nav-item[onclick*="profile"]').classList.add('active');
            },

            // æäº¤è®¢å•
            submitOrder() {
                const name = document.getElementById('profileName').value.trim();
                const phone = document.getElementById('profilePhone').value.trim();
                const address = document.getElementById('profileAddress').value.trim();

                if (!name || !phone || !address) {
                    this.showNotification('è¯·å¡«å†™å®Œæ•´çš„æ”¶è´§ä¿¡æ¯', 'error');
                    return;
                }

                if (this.cart.length === 0) {
                    this.showNotification('è´­ç‰©è½¦æ˜¯ç©ºçš„', 'error');
                    return;
                }

                // åˆ›å»ºè®¢å•
                const orderId = 'BAKERY' + Date.now();
                const total = this.cart.reduce((sum, item) => sum + item.price * item.quantity, 0);

                const order = {
                    id: orderId,
                    name: name,
                    phone: phone,
                    address: address,
                    items: [...this.cart],
                    total: total,
                    status: 'pending',
                    createdAt: new Date().toISOString(),
                    updatedAt: new Date().toISOString()
                };

                // ä¿å­˜è®¢å•åˆ°æ•°ç»„å’Œæœ¬åœ°å­˜å‚¨
                this.orders.push(order);
                this.saveToStorage();
                
                // å¼ºåˆ¶æ›´æ–°ç»Ÿè®¡
                this.updateStats();
                
                console.log('è®¢å•å·²ä¿å­˜:', order);
                console.log('å½“å‰æ‰€æœ‰è®¢å•:', this.orders);

                // æ˜¾ç¤ºæ”¯ä»˜æ¨¡æ€æ¡†
                this.showPaymentModal(orderId, total);
            },

            // æ˜¾ç¤ºæ”¯ä»˜æ¨¡æ€æ¡†
            showPaymentModal(orderId, amount) {
                document.getElementById('orderNumber').textContent = orderId;
                document.getElementById('paymentAmount').textContent = `Â¥${amount}`;
                document.getElementById('paymentModal').classList.add('active');
            },

            // å…³é—­æ”¯ä»˜æ¨¡æ€æ¡†
            closePaymentModal() {
                document.getElementById('paymentModal').classList.remove('active');
            },

            // ç¡®è®¤æ”¯ä»˜
            confirmPayment() {
                // æ¸…ç©ºè´­ç‰©è½¦
                this.cart = [];
                this.saveToStorage();
                this.updateCartCount();
                
                // å…³é—­æ¨¡æ€æ¡†
                this.closePaymentModal();
                
                // è·³è½¬åˆ°è®¢å•é¡µé¢
                this.showPage('orders');
                
                // æ›´æ–°å¯¼èˆª
                document.querySelectorAll('#userMode .nav-item').forEach(item => {
                    item.classList.remove('active');
                });
                document.querySelector('#userMode .nav-item[onclick*="orders"]').classList.add('active');
                
                this.showNotification('è®¢å•å·²æäº¤ï¼Œè¯·å°½å¿«å®Œæˆæ”¯ä»˜ï¼');
            },

            // æ¸²æŸ“è®¢å•åˆ—è¡¨
            renderOrders() {
                const ordersContainer = document.getElementById('ordersContainer');
                if (!ordersContainer) return;

                if (this.orders.length === 0) {
                    ordersContainer.innerHTML = `
                        <div class="empty-state">
                            <h3>æš‚æ— è®¢å•</h3>
                            <p>å»é€‰è´­ç¾å‘³çš„é¢åŒ…å§ï¼</p>
                        </div>
                    `;
                    return;
                }

                let ordersHTML = '';
                
                // æŒ‰æ—¶é—´å€’åºæ’åˆ—
                const sortedOrders = [...this.orders].sort((a, b) => 
                    new Date(b.createdAt) - new Date(a.createdAt)
                );

                sortedOrders.forEach(order => {
                    const statusClass = `status-${order.status}`;
                    const statusText = this.getStatusText(order.status);
                    
                    ordersHTML += `
                        <div class="order-card">
                            <div class="order-header">
                                <div>
                                    <div class="order-id">è®¢å•å·ï¼š${order.id}</div>
                                    <div style="font-size: 12px; color: var(--text-light); margin-top: 5px;">
                                        ${new Date(order.createdAt).toLocaleString()}
                                    </div>
                                </div>
                                <div class="order-status ${statusClass}">${statusText}</div>
                            </div>
                            
                            <div class="order-items">
                                ${order.items.map(item => `
                                    <div class="order-item">
                                        <span>${item.name} Ã— ${item.quantity}</span>
                                        <span>Â¥${item.price * item.quantity}</span>
                                    </div>
                                `).join('')}
                            </div>
                            
                            <div class="order-footer">
                                <div class="order-total">æ€»è®¡ï¼šÂ¥${order.total}</div>
                                <div class="order-actions">
                                    <button class="action-btn secondary" onclick="app.viewOrderDetail('${order.id}')">
                                        æŸ¥çœ‹è¯¦æƒ…
                                    </button>
                                    <button class="action-btn primary" onclick="app.reorder('${order.id}')">
                                        å†æ¬¡è´­ä¹°
                                    </button>
                                </div>
                            </div>
                        </div>
                    `;
                });

                ordersContainer.innerHTML = ordersHTML;
            },

            // è·å–çŠ¶æ€æ–‡æœ¬
            getStatusText(status) {
                const statusMap = {
                    'pending': 'å¾…å¤„ç†',
                    'processing': 'åˆ¶ä½œä¸­',
                    'completed': 'å·²å®Œæˆ',
                    'cancelled': 'å·²å–æ¶ˆ'
                };
                return statusMap[status] || status;
            },

            // æŸ¥çœ‹è®¢å•è¯¦æƒ…
            viewOrderDetail(orderId) {
                const order = this.orders.find(o => o.id === orderId);
                if (!order) return;

                let detailHTML = `
                    <div style="padding: 20px;">
                        <h3>è®¢å•è¯¦æƒ…</h3>
                        <p><strong>è®¢å•å·ï¼š</strong>${order.id}</p>
                        <p><strong>çŠ¶æ€ï¼š</strong>${this.getStatusText(order.status)}</p>
                        <p><strong>æ”¶è´§äººï¼š</strong>${order.name}</p>
                        <p><strong>ç”µè¯ï¼š</strong>${order.phone}</p>
                        <p><strong>åœ°å€ï¼š</strong>${order.address}</p>
                        <p><strong>ä¸‹å•æ—¶é—´ï¼š</strong>${new Date(order.createdAt).toLocaleString()}</p>
                        <hr style="margin: 15px 0;">
                        <h4>å•†å“æ¸…å•</h4>
                `;

                order.items.forEach(item => {
                    detailHTML += `<p>${item.name} Ã— ${item.quantity} = Â¥${item.price * item.quantity}</p>`;
                });

                detailHTML += `
                    <hr style="margin: 15px 0;">
                    <p><strong>æ€»è®¡ï¼šÂ¥${order.total}</strong></p>
                `;

                this.showModal('è®¢å•è¯¦æƒ…', detailHTML);
            },

            // å†æ¬¡è´­ä¹°
            reorder(orderId) {
                const order = this.orders.find(o => o.id === orderId);
                if (!order) return;

                // æ¸…ç©ºå½“å‰è´­ç‰©è½¦
                this.cart = [];
                
                // å°†è®¢å•å•†å“åŠ å…¥è´­ç‰©è½¦
                order.items.forEach(item => {
                    const existingItem = this.cart.find(cartItem => cartItem.id === item.id);
                    if (existingItem) {
                        existingItem.quantity += item.quantity;
                    } else {
                        this.cart.push({...item});
                    }
                });

                this.saveToStorage();
                this.updateCartCount();
                
                // åˆ‡æ¢åˆ°è´­ç‰©è½¦é¡µé¢
                this.showPage('cart');
                
                // æ›´æ–°å¯¼èˆª
                document.querySelectorAll('#userMode .nav-item').forEach(item => {
                    item.classList.remove('active');
                });
                document.querySelector('#userMode .nav-item[onclick*="cart"]').classList.add('active');
                
                this.showNotification('å·²å°†å•†å“åŠ å…¥è´­ç‰©è½¦');
            },

            // ä¿å­˜ä¸ªäººä¿¡æ¯
            saveProfile() {
                const name = document.getElementById('profileName').value.trim();
                const phone = document.getElementById('profilePhone').value.trim();
                const address = document.getElementById('profileAddress').value.trim();

                this.profile = { name, phone, address };
                this.saveToStorage();
                
                this.showNotification('ä¸ªäººä¿¡æ¯å·²ä¿å­˜');
                
                // å¦‚æœè´­ç‰©è½¦ä¸ä¸ºç©ºï¼Œç›´æ¥æäº¤è®¢å•
                if (this.cart.length > 0) {
                    this.submitOrder();
                }
            },

            // åŠ è½½ä¸ªäººä¿¡æ¯
            loadProfile() {
                document.getElementById('profileName').value = this.profile.name || '';
                document.getElementById('profilePhone').value = this.profile.phone || '';
                document.getElementById('profileAddress').value = this.profile.address || '';
            },

            // æ›´æ–°ç»Ÿè®¡æ•°æ®
            updateStats() {
                // æ€»è®¢å•æ•°
                const totalOrders = this.orders.length;
                document.getElementById('totalOrders').textContent = totalOrders;

                // æ€»æ”¶å…¥
                const totalRevenue = this.orders.reduce((sum, order) => sum + order.total, 0);
                document.getElementById('totalRevenue').textContent = `Â¥${totalRevenue}`;

                // ä»Šæ—¥è®¢å•
                const today = new Date().toDateString();
                const todayOrders = this.orders.filter(order => 
                    new Date(order.createdAt).toDateString() === today
                ).length;
                document.getElementById('todayOrders').textContent = todayOrders;

                // å¾…å¤„ç†è®¢å•
                const pendingOrders = this.orders.filter(order => 
                    order.status === 'pending'
                ).length;
                document.getElementById('pendingOrders').textContent = pendingOrders;

                // çƒ­é”€å•†å“
                this.updateHotProducts();
            },

            // æ›´æ–°çƒ­é”€å•†å“
            updateHotProducts() {
                const productSales = {};
                
                // ç»Ÿè®¡æ¯ä¸ªå•†å“çš„é”€å”®æ•°é‡
                this.orders.forEach(order => {
                    if (order.status !== 'cancelled') {
                        order.items.forEach(item => {
                            if (productSales[item.id]) {
                                productSales[item.id].quantity += item.quantity;
                                productSales[item.id].revenue += item.price * item.quantity;
                            } else {
                                productSales[item.id] = {
                                    name: item.name,
                                    quantity: item.quantity,
                                    emoji: item.emoji,
                                    revenue: item.price * item.quantity
                                };
                            }
                        });
                    }
                });

                // æ’åºå¹¶æ˜¾ç¤ºå‰5å
                const sortedProducts = Object.values(productSales)
                    .sort((a, b) => b.quantity - a.quantity)
                    .slice(0, 5);

                const hotProductsHTML = sortedProducts.map((product, index) => `
                    <div style="display: flex; justify-content: space-between; align-items: center; padding: 10px; background: var(--bg-white); border-radius: 8px; margin-bottom: 10px;">
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <div style="width: 30px; height: 30px; background: var(--primary-color); color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold;">
                                ${index + 1}
                            </div>
                            <div>${product.emoji} ${product.name}</div>
                        </div>
                        <div style="text-align: right;">
                            <div style="font-weight: 600; color: var(--primary-color);">${product.quantity} ä»½</div>
                            <div style="font-size: 12px; color: var(--text-light);">Â¥${product.revenue}</div>
                        </div>
                    </div>
                `).join('');

                const hotProductsContainer = document.getElementById('hotProducts');
                if (hotProductsContainer) {
                    hotProductsContainer.innerHTML = hotProductsHTML || '<p style="color: var(--text-light);">æš‚æ— é”€å”®æ•°æ®</p>';
                }
            },

            // æ¸²æŸ“é”€å”®åˆ†æ
            renderAnalytics() {
                if (!this.orders.length) {
                    this.showEmptyAnalytics();
                    return;
                }

                // è®¡ç®—ç»Ÿè®¡æ•°æ®
                const completedOrders = this.orders.filter(o => o.status === 'completed');
                const totalRevenue = completedOrders.reduce((sum, order) => sum + order.total, 0);
                const totalItemsSold = completedOrders.reduce((sum, order) => 
                    sum + order.items.reduce((itemSum, item) => itemSum + item.quantity, 0), 0
                );
                const avgOrderValue = completedOrders.length > 0 ? totalRevenue / completedOrders.length : 0;
                const conversionRate = this.orders.length > 0 ? (completedOrders.length / this.orders.length * 100).toFixed(1) : 0;

                // æ›´æ–°å®æ—¶æ•°æ®
                this.updateLiveAnalytics(totalRevenue, totalItemsSold, avgOrderValue, conversionRate, completedOrders.length);
                
                // å®¢æˆ·åˆ†æ
                this.renderCustomerAnalytics(completedOrders);
                
                // æ—¶é—´åˆ†æ
                this.renderTimeAnalytics(completedOrders);
                
                // å•†å“é”€é‡å›¾è¡¨
                this.renderProductSalesChart(completedOrders);
                
                // æ¯æ—¥é”€å”®è¶‹åŠ¿
                this.renderDailySalesChart(completedOrders);
                
                // é«˜å³°æ—¶æ®µåˆ†æ
                this.renderPeakHoursChart(completedOrders);
                
                // å•†å“ç»„åˆåˆ†æ
                this.renderProductCombination(completedOrders);
                
                // è¯¦ç»†æ•°æ®è¡¨æ ¼
                this.renderDetailedSalesData(completedOrders);
            },

            // æ˜¾ç¤ºç©ºæ•°æ®åˆ†æé¡µé¢
            showEmptyAnalytics() {
                const emptyHTML = '<div style="text-align: center; padding: 60px 20px; color: var(--text-light);"><div style="font-size: 48px; margin-bottom: 20px;">ğŸ“Š</div><h3>æš‚æ— é”€å”®æ•°æ®</h3><p>å¼€å§‹æ¥å•åï¼Œè¿™é‡Œå°†æ˜¾ç¤ºè¯¦ç»†çš„é”€å”®åˆ†æ</p></div>';
                
                document.getElementById('productSalesChart').innerHTML = emptyHTML;
                document.getElementById('dailySalesChart').innerHTML = emptyHTML;
                document.getElementById('detailedSalesData').innerHTML = emptyHTML;
                document.getElementById('customerAnalytics').innerHTML = emptyHTML;
                document.getElementById('timeAnalytics').innerHTML = emptyHTML;
                document.getElementById('peakHoursChart').innerHTML = emptyHTML;
                document.getElementById('productCombination').innerHTML = emptyHTML;
                
                // æ›´æ–°ç»Ÿè®¡
                this.updateLiveAnalytics(0, 0, 0, 0, 0);
            },

            // æ›´æ–°å®æ—¶åˆ†ææ•°æ®
            updateLiveAnalytics(totalRevenue, totalItemsSold, avgOrderValue, conversionRate, completedCount) {
                // ä½¿ç”¨åŠ¨ç”»æ•ˆæœæ›´æ–°æ•°å­—
                this.animateNumber('liveTotalRevenue', totalRevenue, 'Â¥');
                this.animateNumber('liveTotalItemsSold', totalItemsSold);
                this.animateNumber('liveAvgOrderValue', avgOrderValue, 'Â¥');
                this.animateNumber('liveConversionRate', conversionRate, '', '%');
                
                // æ¨¡æ‹Ÿå¢é•¿æ•°æ®
                document.getElementById('revenueGrowth').textContent = `+${(Math.random() * 20 + 5).toFixed(1)}%`;
                document.getElementById('salesGrowth').textContent = `+${(Math.random() * 15 + 3).toFixed(1)}%`;
                document.getElementById('avgOrderGrowth').textContent = `+${(Math.random() * 10 + 2).toFixed(1)}%`;
                document.getElementById('conversionGrowth').textContent = `+${(Math.random() * 8 + 1).toFixed(1)}%`;
            },

            // æ•°å­—åŠ¨ç”»æ•ˆæœ
            animateNumber(elementId, targetValue, prefix = '', suffix = '') {
                const element = document.getElementById(elementId);
                if (!element) return;
                
                const startValue = 0;
                const duration = 1500;
                const startTime = Date.now();
                
                const animate = () => {
                    const currentTime = Date.now();
                    const elapsed = currentTime - startTime;
                    const progress = Math.min(elapsed / duration, 1);
                    
                    const easeOutQuart = 1 - Math.pow(1 - progress, 4);
                    const currentValue = startValue + (targetValue - startValue) * easeOutQuart;
                    
                    if (elementId.includes('Value') || elementId.includes('Revenue')) {
                        element.textContent = prefix + currentValue.toFixed(2) + suffix;
                    } else {
                        element.textContent = prefix + Math.floor(currentValue) + suffix;
                    }
                    
                    if (progress < 1) {
                        requestAnimationFrame(animate);
                    }
                };
                
                animate();
            },

            // æ¸²æŸ“å®¢æˆ·åˆ†æ
            renderCustomerAnalytics(orders) {
                const customerData = {};
                let totalCustomers = new Set();
                
                orders.forEach(order => {
                    totalCustomers.add(order.phone);
                    
                    const itemCount = order.items.reduce((sum, item) => sum + item.quantity, 0);
                    if (itemCount <= 2) {
                        customerData['å°é¢å®¢æˆ·'] = (customerData['å°é¢å®¢æˆ·'] || 0) + 1;
                    } else if (itemCount <= 5) {
                        customerData['æ™®é€šå®¢æˆ·'] = (customerData['æ™®é€šå®¢æˆ·'] || 0) + 1;
                    } else {
                        customerData['å¤§é¢å®¢æˆ·'] = (customerData['å¤§é¢å®¢æˆ·'] || 0) + 1;
                    }
                });

                const customerHTML = `
                    <div style="margin-bottom: 20px;">
                        <div style="font-size: 24px; font-weight: bold; color: var(--primary-color); margin-bottom: 5px;">
                            ${totalCustomers.size}
                        </div>
                        <div style="font-size: 14px; color: var(--text-light);">æ€»å®¢æˆ·æ•°</div>
                    </div>
                    <div>
                        ${Object.entries(customerData).map(([type, count]) => `
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; padding: 8px; background: var(--bg-light); border-radius: 6px;">
                                <span>${type}</span>
                                <span style="font-weight: bold; color: var(--primary-color);">${count}</span>
                            </div>
                        `).join('')}
                    </div>
                    <div style="margin-top: 15px; padding: 10px; background: #e3f2fd; border-radius: 6px; text-align: center;">
                        <div style="font-size: 12px; color: #1976d2;">å¹³å‡å¤è´­ç‡</div>
                        <div style="font-size: 18px; font-weight: bold; color: #1976d2;">${(Math.random() * 30 + 20).toFixed(1)}%</div>
                    </div>
                `;

                document.getElementById('customerAnalytics').innerHTML = customerHTML;
            },

            // æ¸²æŸ“æ—¶é—´åˆ†æ
            renderTimeAnalytics(orders) {
                const hourData = {};
                const weekdayData = {};
                
                orders.forEach(order => {
                    const date = new Date(order.createdAt);
                    const hour = date.getHours();
                    const weekday = ['å‘¨æ—¥', 'å‘¨ä¸€', 'å‘¨äºŒ', 'å‘¨ä¸‰', 'å‘¨å››', 'å‘¨äº”', 'å‘¨å…­'][date.getDay()];
                    
                    hourData[hour] = (hourData[hour] || 0) + 1;
                    weekdayData[weekday] = (weekdayData[weekday] || 0) + 1;
                });

                const peakHour = Object.entries(hourData).sort((a, b) => b[1] - a[1])[0];
                const busyWeekday = Object.entries(weekdayData).sort((a, b) => b[1] - a[1])[0];

                const timeHTML = `
                    <div style="margin-bottom: 20px;">
                        <div style="font-size: 14px; color: var(--text-light); margin-bottom: 5px;">ğŸ• é«˜å³°æ—¶æ®µ</div>
                        <div style="font-size: 20px; font-weight: bold; color: var(--primary-color);">
                            ${peakHour ? peakHour[0] + ':00-' + (parseInt(peakHour[0]) + 1) + ':00' : 'æš‚æ— æ•°æ®'}
                        </div>
                    </div>
                    <div style="margin-bottom: 20px;">
                        <div style="font-size: 14px; color: var(--text-light); margin-bottom: 5px;">ğŸ“… ç¹å¿™æ—¥æœŸ</div>
                        <div style="font-size: 20px; font-weight: bold; color: var(--secondary-color);">
                            ${busyWeekday ? busyWeekday[0] : 'æš‚æ— æ•°æ®'}
                        </div>
                    </div>
                    <div style="background: var(--bg-light); padding: 15px; border-radius: 8px;">
                        <div style="font-size: 12px; color: var(--text-light); margin-bottom: 10px;">24å°æ—¶åˆ†å¸ƒ</div>
                        <div style="display: grid; grid-template-columns: repeat(12, 1fr); gap: 2px;">
                            ${Array.from({length: 24}, (_, i) => {
                                const count = hourData[i] || 0;
                                const maxCount = Math.max(...Object.values(hourData));
                                const height = maxCount > 0 ? (count / maxCount) * 100 : 0;
                                const color = i >= 7 && i <= 9 || i >= 17 && i <= 19 ? 'var(--primary-color)' : 'var(--secondary-color)';
                                return `
                                    <div style="text-align: center;">
                                        <div style="background: ${color}; height: ${height}%; border-radius: 2px; margin-bottom: 2px;"></div>
                                        <div style="font-size: 8px; color: var(--text-light);">${i}</div>
                                    </div>
                                `;
                            }).join('')}
                        </div>
                    </div>
                `;

                document.getElementById('timeAnalytics').innerHTML = timeHTML;
            },

            // æ¸²æŸ“é«˜å³°æ—¶æ®µå›¾è¡¨
            renderPeakHoursChart(orders) {
                const hourData = Array(24).fill(0);
                
                orders.forEach(order => {
                    const date = new Date(order.createdAt);
                    const hour = date.getHours();
                    hourData[hour]++;
                });

                const maxCount = Math.max(...hourData);
                
                const chartHTML = `
                    <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px;">
                        ${hourData.map((count, hour) => {
                            const percentage = maxCount > 0 ? (count / maxCount) * 100 : 0;
                            const isActive = percentage > 50;
                            return `
                                <div style="text-align: center; padding: 15px; background: ${isActive ? 'var(--primary-color)' : 'var(--bg-light)'}; color: ${isActive ? 'white' : 'var(--text-dark)'}; border-radius: 8px;">
                                    <div style="font-size: 12px; margin-bottom: 5px;">${hour}:00</div>
                                    <div style="font-size: 18px; font-weight: bold;">${count}</div>
                                    <div style="font-size: 10px; opacity: 0.8;">è®¢å•</div>
                                </div>
                            `;
                        }).join('')}
                    </div>
                    <div style="margin-top: 15px; padding: 10px; background: #fff3cd; border-radius: 6px;">
                        <div style="font-size: 12px; color: #856404;">ğŸ’¡ å»ºè®®ï¼šåœ¨é«˜å³°æ—¶æ®µå¢åŠ äººæ‰‹ï¼Œæé«˜æœåŠ¡æ•ˆç‡</div>
                    </div>
                `;

                document.getElementById('peakHoursChart').innerHTML = chartHTML;
            },

            // æ¸²æŸ“å•†å“ç»„åˆåˆ†æ
            renderProductCombination(orders) {
                const combinations = {};
                
                orders.forEach(order => {
                    const itemNames = order.items.map(item => item.name).sort().join(' + ');
                    combinations[itemNames] = (combinations[itemNames] || 0) + 1;
                });

                const sortedCombinations = Object.entries(combinations)
                    .sort((a, b) => b[1] - a[1])
                    .slice(0, 5);

                const combinationHTML = `
                    ${sortedCombinations.length > 0 ? `
                        <div>
                            ${sortedCombinations.map(([combination, count], index) => `
                                <div style="display: flex; align-items: center; padding: 12px; background: ${index === 0 ? 'var(--primary-color)' : 'var(--bg-light)'}; color: ${index === 0 ? 'white' : 'var(--text-dark)'}; border-radius: 8px; margin-bottom: 10px;">
                                    <div style="width: 24px; height: 24px; background: ${index === 0 ? 'white' : 'var(--primary-color)'}; color: ${index === 0 ? 'var(--primary-color)' : 'white'}; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; margin-right: 10px; font-size: 12px;">
                                        ${index + 1}
                                    </div>
                                    <div style="flex: 1;">
                                        <div style="font-weight: 600; margin-bottom: 2px;">${combination}</div>
                                        <div style="font-size: 12px; opacity: 0.8;">${count} æ¬¡è´­ä¹°</div>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                        <div style="margin-top: 15px; padding: 10px; background: #e8f5e8; border-radius: 6px;">
                            <div style="font-size: 12px; color: #2e7d32;">ğŸ’¡ è¥é”€å»ºè®®ï¼šå°†çƒ­é—¨ç»„åˆæ‰“åŒ…æˆå¥—é¤ï¼Œæä¾›ä¼˜æƒ </div>
                        </div>
                    ` : `
                        <div style="text-align: center; padding: 40px; color: var(--text-light);">
                            <div style="font-size: 32px; margin-bottom: 10px;">ğŸ›’</div>
                            <div>æš‚æ— ç»„åˆæ•°æ®</div>
                        </div>
                    `}
                `;

                document.getElementById('productCombination').innerHTML = combinationHTML;
            },

            // æ¸²æŸ“å•†å“é”€é‡å›¾è¡¨
            renderProductSalesChart(orders) {
                const productSales = {};
                
                orders.forEach(order => {
                    order.items.forEach(item => {
                        if (productSales[item.id]) {
                            productSales[item.id].quantity += item.quantity;
                            productSales[item.id].revenue += item.price * item.quantity;
                        } else {
                            productSales[item.id] = {
                                name: item.name,
                                emoji: item.emoji,
                                quantity: item.quantity,
                                revenue: item.price * item.quantity
                            };
                        }
                    });
                });

                const sortedProducts = Object.values(productSales)
                    .sort((a, b) => b.quantity - a.quantity);

                const maxQuantity = Math.max(...sortedProducts.map(p => p.quantity));
                
                const chartHTML = sortedProducts.slice(0, 6).map(product => {
                    const percentage = (product.quantity / maxQuantity) * 100;
                    return `
                        <div style="margin-bottom: 15px;">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 5px;">
                                <span>${product.emoji} ${product.name}</span>
                                <span style="font-weight: 600; color: var(--primary-color);">${product.quantity}ä»¶</span>
                            </div>
                            <div style="background: #f0f0f0; height: 20px; border-radius: 10px; overflow: hidden;">
                                <div style="background: linear-gradient(90deg, var(--primary-color), var(--secondary-color)); height: 100%; width: ${percentage}%; border-radius: 10px; transition: width 0.5s ease;"></div>
                            </div>
                            <div style="font-size: 12px; color: var(--text-light); margin-top: 3px;">æ”¶å…¥: Â¥${product.revenue}</div>
                        </div>
                    `;
                }).join('');

                document.getElementById('productSalesChart').innerHTML = chartHTML || '<p style="color: var(--text-light); text-align: center;">æš‚æ— é”€å”®æ•°æ®</p>';
            },

            // æ¸²æŸ“æ¯æ—¥é”€å”®è¶‹åŠ¿
            renderDailySalesChart(orders) {
                const dailySales = {};
                
                orders.forEach(order => {
                    const date = new Date(order.createdAt).toLocaleDateString();
                    if (dailySales[date]) {
                        dailySales[date].revenue += order.total;
                        dailySales[date].count += 1;
                    } else {
                        dailySales[date] = {
                            revenue: order.total,
                            count: 1
                        };
                    }
                });

                const dates = Object.keys(dailySales).sort().slice(-7); // æœ€è¿‘7å¤©
                const maxRevenue = Math.max(...dates.map(date => dailySales[date].revenue));

                const chartHTML = dates.map(date => {
                    const revenue = dailySales[date].revenue;
                    const count = dailySales[date].count;
                    const percentage = maxRevenue > 0 ? (revenue / maxRevenue) * 100 : 0;
                    
                    return `
                        <div style="text-align: center; margin-bottom: 15px;">
                            <div style="font-size: 12px; color: var(--text-light); margin-bottom: 5px;">${date.slice(5)}</div>
                            <div style="background: #f0f0f0; height: 60px; border-radius: 6px; overflow: hidden; position: relative;">
                                <div style="background: linear-gradient(180deg, var(--secondary-color), var(--primary-color)); height: ${percentage}%; width: 100%; position: absolute; bottom: 0; border-radius: 6px;"></div>
                            </div>
                            <div style="font-size: 11px; font-weight: 600; color: var(--primary-color); margin-top: 3px;">Â¥${revenue}</div>
                            <div style="font-size: 10px; color: var(--text-light);">${count}å•</div>
                        </div>
                    `;
                }).join('');

                const containerHTML = `
                    <div style="display: grid; grid-template-columns: repeat(7, 1fr); gap: 5px;">
                        ${chartHTML || '<div style="grid-column: 1/-1; text-align: center; color: var(--text-light);">æš‚æ— é”€å”®æ•°æ®</div>'}
                    </div>
                `;

                document.getElementById('dailySalesChart').innerHTML = containerHTML;
            },

            // æ¸²æŸ“è¯¦ç»†é”€å”®æ•°æ®
            renderDetailedSalesData(orders) {
                const productData = {};
                
                orders.forEach(order => {
                    order.items.forEach(item => {
                        if (productData[item.id]) {
                            productData[item.id].quantity += item.quantity;
                            productData[item.id].revenue += item.price * item.quantity;
                        } else {
                            productData[item.id] = {
                                name: item.name,
                                emoji: item.emoji,
                                price: item.price,
                                quantity: item.quantity,
                                revenue: item.price * item.quantity
                            };
                        }
                    });
                });

                const sortedData = Object.values(productData)
                    .sort((a, b) => b.revenue - a.revenue);

                const tableHTML = `
                    <div style="overflow-x: auto;">
                        <table style="width: 100%; border-collapse: collapse;">
                            <thead>
                                <tr style="background: var(--bg-light);">
                                    <th style="padding: 12px; text-align: left; border-bottom: 2px solid #ddd;">å•†å“</th>
                                    <th style="padding: 12px; text-align: center; border-bottom: 2px solid #ddd;">å•ä»·</th>
                                    <th style="padding: 12px; text-align: center; border-bottom: 2px solid #ddd;">é”€é‡</th>
                                    <th style="padding: 12px; text-align: right; border-bottom: 2px solid #ddd;">æ”¶å…¥</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${sortedData.map((item, index) => `
                                    <tr style="${index % 2 === 0 ? 'background: var(--bg-white);' : 'background: #fafafa;'}">
                                        <td style="padding: 12px; border-bottom: 1px solid #eee;">
                                            ${item.emoji} ${item.name}
                                        </td>
                                        <td style="padding: 12px; text-align: center; border-bottom: 1px solid #eee;">
                                            Â¥${item.price}
                                        </td>
                                        <td style="padding: 12px; text-align: center; border-bottom: 1px solid #eee;">
                                            ${item.quantity}ä»¶
                                        </td>
                                        <td style="padding: 12px; text-align: right; font-weight: 600; color: var(--primary-color); border-bottom: 1px solid #eee;">
                                            Â¥${item.revenue}
                                        </td>
                                    </tr>
                                `).join('')}
                            </tbody>
                            <tfoot>
                                <tr style="background: var(--bg-light); font-weight: bold;">
                                    <td style="padding: 12px; border-top: 2px solid #ddd;">æ€»è®¡</td>
                                    <td style="padding: 12px; text-align: center; border-top: 2px solid #ddd;">-</td>
                                    <td style="padding: 12px; text-align: center; border-top: 2px solid #ddd;">
                                        ${sortedData.reduce((sum, item) => sum + item.quantity, 0)}ä»¶
                                    </td>
                                    <td style="padding: 12px; text-align: right; color: var(--primary-color); border-top: 2px solid #ddd;">
                                        Â¥${sortedData.reduce((sum, item) => sum + item.revenue, 0)}
                                    </td>
                                </tr>
                            </tfoot>
                        </table>
                    </div>
                `;

                document.getElementById('detailedSalesData').innerHTML = tableHTML;
            },

            // æ¸²æŸ“å•†å®¶è®¢å•ç®¡ç†
            renderMerchantOrders() {
                console.log('=== å¼€å§‹æ¸²æŸ“å•†å®¶è®¢å• ===');
                
                const ordersContainer = document.getElementById('merchantOrdersContainer');
                if (!ordersContainer) {
                    console.error('æ‰¾ä¸åˆ°merchantOrdersContainerå…ƒç´ ');
                    return;
                }

                // é‡æ–°ä»å­˜å‚¨åŠ è½½è®¢å•ä»¥ç¡®ä¿æ•°æ®åŒæ­¥
                const storedOrders = localStorage.getItem('bakery_orders');
                console.log('å­˜å‚¨ä¸­çš„è®¢å•æ•°æ®:', storedOrders);
                
                if (storedOrders) {
                    this.orders = JSON.parse(storedOrders);
                    console.log('ä»å­˜å‚¨åŠ è½½è®¢å•æˆåŠŸï¼Œæ•°é‡:', this.orders.length);
                } else {
                    console.log('å­˜å‚¨ä¸­æ²¡æœ‰è®¢å•æ•°æ®ï¼Œä½¿ç”¨å½“å‰æ•°ç»„');
                    // ä½¿ç”¨å½“å‰æ•°ç»„çš„æ•°æ®
                }

                console.log('æœ€ç»ˆå¤„ç†çš„è®¢å•æ•°é‡:', this.orders.length);

                const totalOrders = this.orders.length;
                const pendingOrders = this.orders.filter(o => o.status === 'pending').length;
                const completedOrders = this.orders.filter(o => o.status === 'completed').length;

                let ordersHTML = `
                    <div style="background: var(--bg-light); padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                        <h3>è®¢å•ç»Ÿè®¡</h3>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 10px; margin-top: 15px;">
                            <div style="text-align: center; padding: 10px; background: var(--bg-white); border-radius: 8px;">
                                <div style="font-size: 20px; font-weight: bold; color: var(--primary-color);">${totalOrders}</div>
                                <div style="font-size: 12px; color: var(--text-light);">æ€»è®¢å•</div>
                            </div>
                            <div style="text-align: center; padding: 10px; background: var(--bg-white); border-radius: 8px;">
                                <div style="font-size: 20px; font-weight: bold; color: #FF6B6B;">${pendingOrders}</div>
                                <div style="font-size: 12px; color: var(--text-light);">å¾…å¤„ç†</div>
                            </div>
                            <div style="text-align: center; padding: 10px; background: var(--bg-white); border-radius: 8px;">
                                <div style="font-size: 20px; font-weight: bold; color: #4ECDC4;">${completedOrders}</div>
                                <div style="font-size: 12px; color: var(--text-light);">å·²å®Œæˆ</div>
                            </div>
                        </div>
                    </div>

                    <div style="margin-bottom: 20px;">
                        <button class="action-btn primary" onclick="app.filterOrders('all')">å…¨éƒ¨è®¢å•</button>
                        <button class="action-btn secondary" onclick="app.filterOrders('pending')">å¾…å¤„ç†</button>
                        <button class="action-btn secondary" onclick="app.filterOrders('processing')">åˆ¶ä½œä¸­</button>
                        <button class="action-btn secondary" onclick="app.filterOrders('completed')">å·²å®Œæˆ</button>
                        <button class="action-btn secondary" onclick="app.testAddOrder()">æµ‹è¯•è®¢å•</button>
                        <button class="action-btn primary" onclick="app.refreshOrders()">ğŸ”„ åˆ·æ–°</button>
                    </div>
                `;

                if (this.orders.length === 0) {
                    ordersHTML += `
                        <div class="empty-state">
                            <h3>æš‚æ— è®¢å•</h3>
                            <p>è¿˜æ²¡æœ‰æ”¶åˆ°ä»»ä½•è®¢å•ï¼Œè¯·å…ˆåœ¨ç”¨æˆ·ç«¯ä¸‹å•æˆ–æ·»åŠ æµ‹è¯•è®¢å•</p>
                            <button class="action-btn primary" onclick="app.testAddOrder()" style="margin-top: 15px;">æ·»åŠ æµ‹è¯•è®¢å•</button>
                        </div>
                    `;
                } else {
                    console.log('å¼€å§‹æ¸²æŸ“è®¢å•ï¼Œè®¢å•æ•°é‡:', this.orders.length);
                    
                    // æŒ‰çŠ¶æ€å’Œæ—¶é—´æ’åº
                    const sortedOrders = [...this.orders].sort((a, b) => {
                        // å¾…å¤„ç†è®¢å•æ’åœ¨å‰é¢
                        if (a.status === 'pending' && b.status !== 'pending') return -1;
                        if (a.status !== 'pending' && b.status === 'pending') return 1;
                        // ç›¸åŒçŠ¶æ€æŒ‰æ—¶é—´å€’åº
                        return new Date(b.createdAt) - new Date(a.createdAt);
                    });

                    sortedOrders.forEach((order, index) => {
                        console.log(`æ¸²æŸ“è®¢å• ${index + 1}:`, order);
                        
                        const statusClass = `status-${order.status}`;
                        const statusText = this.getStatusText(order.status);
                        
                        // ç¡®ä¿è®¢å•æ•°æ®å®Œæ•´æ€§
                        const orderName = order.name || 'æœªæä¾›';
                        const orderPhone = order.phone || 'æœªæä¾›';
                        const orderAddress = order.address || 'æœªæä¾›';
                        
                        const orderHTML = `
                            <div class="order-card" style="margin-bottom: 15px;">
                                <div class="order-header">
                                    <div>
                                        <div class="order-id">è®¢å•å·ï¼š${order.id}</div>
                                        <div style="font-size: 12px; color: var(--text-light); margin-top: 5px;">
                                            ğŸ“ ${orderPhone} | ğŸ‘¤ ${orderName}
                                        </div>
                                        <div style="font-size: 11px; color: var(--text-light); margin-top: 3px;">
                                            ğŸ•’ ${new Date(order.createdAt).toLocaleString()}
                                        </div>
                                    </div>
                                    <div class="order-status ${statusClass}">${statusText}</div>
                                </div>
                                
                                <div class="order-items">
                                    ${order.items.map(item => `
                                        <div class="order-item">
                                            <span>${item.emoji || 'ğŸ¥'} ${item.name} Ã— ${item.quantity}</span>
                                            <span>Â¥${item.price * item.quantity}</span>
                                        </div>
                                    `).join('')}
                                </div>
                                
                                <div style="font-size: 13px; color: var(--text-dark); margin: 10px 0; padding: 8px; background: var(--bg-light); border-radius: 6px;">
                                    ğŸ“ ${orderAddress}
                                </div>
                                
                                <div class="order-footer">
                                    <div class="order-total">æ€»è®¡ï¼šÂ¥${order.total}</div>
                                    <div class="order-actions">
                                        ${this.getOrderActionButtons(order)}
                                    </div>
                                </div>
                            </div>
                        `;
                        
                        ordersHTML += orderHTML;
                    });
                }

                console.log('æœ€ç»ˆè®¢å•HTML:', ordersHTML);
                ordersContainer.innerHTML = ordersHTML;
            },

            // è·å–è®¢å•æ“ä½œæŒ‰é’®
            getOrderActionButtons(order) {
                switch (order.status) {
                    case 'pending':
                        return `
                            <button class="action-btn primary" onclick="app.updateOrderStatus('${order.id}', 'processing')">
                                å¼€å§‹åˆ¶ä½œ
                            </button>
                            <button class="action-btn secondary" onclick="app.updateOrderStatus('${order.id}', 'cancelled')">
                                å–æ¶ˆè®¢å•
                            </button>
                        `;
                    case 'processing':
                        return `
                            <button class="action-btn primary" onclick="app.updateOrderStatus('${order.id}', 'completed')">
                                å®Œæˆè®¢å•
                            </button>
                        `;
                    case 'completed':
                        return `
                            <button class="action-btn secondary" onclick="app.viewOrderDetail('${order.id}')">
                                æŸ¥çœ‹è¯¦æƒ…
                            </button>
                        `;
                    case 'cancelled':
                        return `
                            <button class="action-btn secondary" onclick="app.viewOrderDetail('${order.id}')">
                                æŸ¥çœ‹è¯¦æƒ…
                            </button>
                        `;
                    default:
                        return '';
                }
            },

            // æ›´æ–°è®¢å•çŠ¶æ€
            updateOrderStatus(orderId, newStatus) {
                const order = this.orders.find(o => o.id === orderId);
                if (!order) return;

                order.status = newStatus;
                order.updatedAt = new Date().toISOString();
                
                this.saveToStorage();
                this.updateStats();
                this.renderMerchantOrders();
                
                const statusText = this.getStatusText(newStatus);
                this.showNotification(`è®¢å•çŠ¶æ€å·²æ›´æ–°ä¸ºï¼š${statusText}`);
            },

            // æ¸²æŸ“å•†å“ç®¡ç†
            renderProductManagement() {
                const productForm = document.getElementById('productForm');
                if (!productForm) return;

                let formHTML = `
                    <div style="background: var(--bg-light); padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                        <h3>å•†å“æ€»è§ˆ</h3>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 10px; margin-top: 15px;">
                            <div style="text-align: center; padding: 10px; background: var(--bg-white); border-radius: 8px;">
                                <div style="font-size: 20px; font-weight: bold; color: var(--primary-color);">${this.products.length}</div>
                                <div style="font-size: 12px; color: var(--text-light);">å•†å“æ€»æ•°</div>
                            </div>
                            <div style="text-align: center; padding: 10px; background: var(--bg-white); border-radius: 8px;">
                                <div style="font-size: 20px; font-weight: bold; color: #4ECDC4;">${this.products.reduce((sum, p) => sum + (p.stock || 0), 0)}</div>
                                <div style="font-size: 12px; color: var(--text-light);">æ€»åº“å­˜</div>
                            </div>
                            <div style="text-align: center; padding: 10px; background: var(--bg-white); border-radius: 8px;">
                                <div style="font-size: 20px; font-weight: bold; color: #FFD93D;">${this.products.filter(p => (p.stock || 0) > 0).length}</div>
                                <div style="font-size: 12px; color: var(--text-light);">æœ‰è´§å•†å“</div>
                            </div>
                        </div>
                    </div>
                `;
                
                this.products.forEach(product => {
                    const stock = product.stock || 0;
                    const sales = product.sales || 0;
                    const stockStatus = stock > 10 ? 'å……è¶³' : stock > 0 ? 'ç´§å¼ ' : 'ç¼ºè´§';
                    const stockColor = stock > 10 ? '#4ECDC4' : stock > 0 ? '#FFD93D' : '#FF6B6B';
                    
                    formHTML += `
                        <div style="background: var(--bg-white); padding: 20px; border-radius: 8px; margin-bottom: 15px; border-left: 4px solid ${stockColor};">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                                <h3>${product.emoji} ${product.name}</h3>
                                <div style="display: flex; gap: 10px;">
                                    <div style="padding: 8px 12px; background: var(--bg-light); border-radius: 20px; font-size: 12px;">
                                        åº“å­˜: <strong style="color: ${stockColor};">${stock}</strong> ä»¶
                                    </div>
                                    <div style="padding: 8px 12px; background: var(--bg-light); border-radius: 20px; font-size: 12px;">
                                        å·²å”®: <strong>${sales}</strong> ä»¶
                                    </div>
                                    <div style="padding: 8px 12px; background: ${stockColor}; color: white; border-radius: 20px; font-size: 12px; font-weight: bold;">
                                        ${stockStatus}
                                    </div>
                                </div>
                            </div>
                            
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                                <div class="form-group">
                                    <label>å•†å“åç§°</label>
                                    <input type="text" id="product-name-${product.id}" value="${product.name}" onchange="app.updateProduct(${product.id}, 'name', this.value)">
                                </div>
                                <div class="form-group">
                                    <label>ä»·æ ¼ (Â¥)</label>
                                    <input type="number" id="product-price-${product.id}" value="${product.price}" min="0" step="0.5" onchange="app.updateProduct(${product.id}, 'price', parseFloat(this.value))">
                                </div>
                                <div class="form-group" style="grid-column: 1 / -1;">
                                    <label>å•†å“æè¿°</label>
                                    <input type="text" id="product-desc-${product.id}" value="${product.description}" onchange="app.updateProduct(${product.id}, 'description', this.value)">
                                </div>
                                <div class="form-group">
                                    <label>emojiå›¾æ ‡</label>
                                    <input type="text" id="product-emoji-${product.id}" value="${product.emoji}" maxlength="2" onchange="app.updateProduct(${product.id}, 'emoji', this.value)">
                                </div>
                                <div class="form-group">
                                    <label>åº“å­˜æ•°é‡</label>
                                    <input type="number" id="product-stock-${product.id}" value="${stock}" min="0" onchange="app.updateProduct(${product.id}, 'stock', parseInt(this.value))">
                                </div>
                            </div>
                            
                            <div style="display: flex; gap: 10px; margin-top: 15px; justify-content: flex-end;">
                                <button class="action-btn secondary" onclick="app.quickAddStock(${product.id})">å¿«é€Ÿè¡¥è´§+10</button>
                                <button class="action-btn primary" onclick="app.saveProduct(${product.id})">ä¿å­˜æ›´æ”¹</button>
                            </div>
                        </div>
                    `;
                });

                productForm.innerHTML = formHTML;
            },

            // æ›´æ–°å•†å“ä¿¡æ¯
            updateProduct(productId, field, value) {
                const product = this.products.find(p => p.id === productId);
                if (!product) return;

                product[field] = value;
                this.saveToStorage();
                this.renderProducts();
                
                this.showNotification('å•†å“ä¿¡æ¯å·²æ›´æ–°');
            },

            // å¿«é€Ÿè¡¥è´§
            quickAddStock(productId) {
                const product = this.products.find(p => p.id === productId);
                if (!product) return;

                product.stock = (product.stock || 0) + 10;
                this.saveToStorage();
                this.renderProductManagement();
                this.renderProducts();
                
                this.showNotification(`å·²ä¸º ${product.name} è¡¥è´§10ä»¶`);
            },

            // ä¿å­˜å•†å“
            saveProduct(productId) {
                const product = this.products.find(p => p.id === productId);
                if (!product) return;

                // è·å–è¡¨å•æ•°æ®
                const name = document.getElementById(`product-name-${productId}`).value;
                const price = parseFloat(document.getElementById(`product-price-${productId}`).value);
                const description = document.getElementById(`product-desc-${productId}`).value;
                const emoji = document.getElementById(`product-emoji-${productId}`).value;
                const stock = parseInt(document.getElementById(`product-stock-${productId}`).value);

                // æ›´æ–°å•†å“ä¿¡æ¯
                product.name = name;
                product.price = price;
                product.description = description;
                product.emoji = emoji;
                product.stock = stock;

                this.saveToStorage();
                this.renderProductManagement();
                this.renderProducts();
                this.updateStats();
                
                this.showNotification(`å•†å“ ${product.name} ä¿¡æ¯å·²ä¿å­˜`);
            },

            // è®¢å•ç­›é€‰
            filterOrders(status) {
                const allOrders = document.querySelectorAll('#merchantOrdersContainer .order-card');
                
                allOrders.forEach(orderCard => {
                    if (status === 'all') {
                        orderCard.style.display = 'block';
                    } else {
                        const statusElement = orderCard.querySelector('.order-status');
                        const currentStatus = statusElement.textContent.trim();
                        
                        // çŠ¶æ€æ˜ å°„
                        const statusMap = {
                            'pending': 'å¾…å¤„ç†',
                            'processing': 'åˆ¶ä½œä¸­', 
                            'completed': 'å·²å®Œæˆ'
                        };
                        
                        if (statusMap[status] === currentStatus) {
                            orderCard.style.display = 'block';
                        } else {
                            orderCard.style.display = 'none';
                        }
                    }
                });

                // æ›´æ–°æŒ‰é’®çŠ¶æ€
                document.querySelectorAll('#merchantOrdersContainer .action-btn').forEach(btn => {
                    if (btn.textContent.includes('å…¨éƒ¨') && status === 'all') {
                        btn.className = 'action-btn primary';
                    } else if (btn.textContent.includes('å¾…å¤„ç†') && status === 'pending') {
                        btn.className = 'action-btn primary';
                    } else if (btn.textContent.includes('åˆ¶ä½œä¸­') && status === 'processing') {
                        btn.className = 'action-btn primary';
                    } else if (btn.textContent.includes('å·²å®Œæˆ') && status === 'completed') {
                        btn.className = 'action-btn primary';
                    } else if (btn.textContent.includes('è®¢å•')) {
                        btn.className = 'action-btn secondary';
                    }
                });
            },

            // æ·»åŠ æµ‹è¯•è®¢å•
            testAddOrder() {
                const testOrder = {
                    id: 'TEST' + Date.now(),
                    name: 'æµ‹è¯•ç”¨æˆ·',
                    phone: '13800138000',
                    address: 'æµ‹è¯•åœ°å€ 123å·',
                    items: [
                        {
                            id: 1,
                            name: 'è´æœ',
                            emoji: 'ğŸ¥¯',
                            price: 5,
                            quantity: 2
                        },
                        {
                            id: 2,
                            name: 'åå¸',
                            emoji: 'ğŸ',
                            price: 10,
                            quantity: 1
                        }
                    ],
                    total: 20,
                    status: 'pending',
                    createdAt: new Date().toISOString(),
                    updatedAt: new Date().toISOString()
                };

                this.orders.push(testOrder);
                this.saveToStorage();
                this.renderMerchantOrders();
                this.updateStats();
                
                console.log('æ·»åŠ æµ‹è¯•è®¢å•:', testOrder);
                this.showNotification('å·²æ·»åŠ æµ‹è¯•è®¢å•');
            },

            // åˆ·æ–°è®¢å•
            refreshOrders() {
                console.log('æ‰‹åŠ¨åˆ·æ–°è®¢å•æ•°æ®...');
                
                // é‡æ–°ä»å­˜å‚¨åŠ è½½æ‰€æœ‰æ•°æ®
                this.loadFromStorage();
                
                // å¼ºåˆ¶é‡æ–°æ¸²æŸ“
                this.renderMerchantOrders();
                this.updateStats();
                
                this.showNotification('è®¢å•æ•°æ®å·²åˆ·æ–°');
                
                // æ˜¾ç¤ºè°ƒè¯•ä¿¡æ¯
                console.log('åˆ·æ–°åçš„è®¢å•æ•°æ®:', this.orders);
                console.log('æœ¬åœ°å­˜å‚¨çš„è®¢å•æ•°æ®:', localStorage.getItem('bakery_orders'));
            },

            // åˆ›å»ºé»˜è®¤æµ‹è¯•è®¢å•
            createDefaultTestOrder() {
                // åˆ›å»ºå¤šä¸ªæ¼”ç¤ºè®¢å•ï¼Œå±•ç¤ºæ•°æ®åˆ†ææ•ˆæœ
                const demoOrders = [
                    {
                        id: 'DEMO' + Date.now(),
                        name: 'æ¼”ç¤ºç”¨æˆ·1',
                        phone: '13888888888',
                        address: 'æ¼”ç¤ºåœ°å€ 123å·',
                        items: [
                            { id: 1, name: 'è´æœ', emoji: 'ğŸ¥¯', price: 5, quantity: 2 },
                            { id: 3, name: 'å°åœ†é¢åŒ…', emoji: 'ğŸ¥–', price: 5, quantity: 3 }
                        ],
                        total: 25,
                        status: 'completed',
                        createdAt: this.getRandomDate(-7),
                        updatedAt: new Date().toISOString()
                    },
                    {
                        id: 'DEMO2' + Date.now(),
                        name: 'æ¼”ç¤ºç”¨æˆ·2',
                        phone: '13999999999',
                        address: 'æ¼”ç¤ºåœ°å€ 456å·',
                        items: [
                            { id: 2, name: 'åå¸', emoji: 'ğŸ', price: 10, quantity: 1 },
                            { id: 6, name: 'ç‰›è§’åŒ…', emoji: 'ğŸ¥', price: 6, quantity: 2 }
                        ],
                        total: 22,
                        status: 'completed',
                        createdAt: this.getRandomDate(-3),
                        updatedAt: new Date().toISOString()
                    },
                    {
                        id: 'DEMO3' + Date.now(),
                        name: 'æ¼”ç¤ºç”¨æˆ·3',
                        phone: '13777777777',
                        address: 'æ¼”ç¤ºåœ°å€ 789å·',
                        items: [
                            { id: 5, name: 'æ³•æ£', emoji: 'ğŸ¥–', price: 8, quantity: 2 },
                            { id: 7, name: 'è èåŒ…', emoji: 'ğŸ', price: 9, quantity: 1 },
                            { id: 8, name: 'ç”œç”œåœˆ', emoji: 'ğŸ©', price: 7, quantity: 3 }
                        ],
                        total: 46,
                        status: 'processing',
                        createdAt: this.getRandomDate(-1),
                        updatedAt: new Date().toISOString()
                    }
                ];

                // æ·»åŠ æ›´å¤šéšæœºè®¢å•æ¥ä¸°å¯Œæ•°æ®
                const randomNames = ['å¼ ä¸‰', 'æå››', 'ç‹äº”', 'èµµå…­', 'é™ˆä¸ƒ', 'åˆ˜å…«'];
                const addresses = ['ä¸­å±±è·¯1å·', 'è§£æ”¾è·¯2å·', 'äººæ°‘è·¯3å·', 'å»ºè®¾è·¯4å·', 'å’Œå¹³è·¯5å·'];
                
                for (let i = 0; i < 15; i++) {
                    const randomOrder = {
                        id: 'RAND' + Date.now() + i,
                        name: randomNames[Math.floor(Math.random() * randomNames.length)] + (i + 1),
                        phone: '138' + String(Math.floor(Math.random() * 100000000)).padStart(8, '0'),
                        address: addresses[Math.floor(Math.random() * addresses.length)],
                        items: this.generateRandomItems(),
                        total: 0,
                        status: ['completed', 'processing', 'pending'][Math.floor(Math.random() * 3)],
                        createdAt: this.getRandomDate(-30),
                        updatedAt: new Date().toISOString()
                    };
                    
                    randomOrder.total = randomOrder.items.reduce((sum, item) => sum + item.price * item.quantity, 0);
                    this.orders.push(randomOrder);
                }

                // æ·»åŠ æ¼”ç¤ºè®¢å•
                demoOrders.forEach(order => this.orders.push(order));
                this.saveToStorage();
                
                console.log('åˆ›å»ºæ¼”ç¤ºè®¢å•æˆåŠŸï¼Œæ€»è®¢å•æ•°:', this.orders.length);
                this.showNotification('å·²åˆ›å»ºæ¼”ç¤ºè®¢å•ï¼ŒåŒ…å«ä¸°å¯Œçš„æ•°æ®åˆ†æå†…å®¹');
            },

            // ç”Ÿæˆéšæœºå•†å“ç»„åˆ
            generateRandomItems() {
                const itemCount = Math.floor(Math.random() * 3) + 1;
                const selectedItems = [];
                const usedIds = new Set();
                
                for (let i = 0; i < itemCount; i++) {
                    let productId;
                    do {
                        productId = Math.floor(Math.random() * this.products.length) + 1;
                    } while (usedIds.has(productId));
                    
                    usedIds.add(productId);
                    const product = this.products.find(p => p.id === productId);
                    if (product) {
                        selectedItems.push({
                            id: product.id,
                            name: product.name,
                            emoji: product.emoji,
                            price: product.price,
                            quantity: Math.floor(Math.random() * 3) + 1
                        });
                    }
                }
                
                return selectedItems;
            },

            // è·å–éšæœºæ—¥æœŸ
            getRandomDate(daysAgo) {
                const date = new Date();
                date.setDate(date.getDate() - Math.floor(Math.random() * Math.abs(daysAgo)));
                
                // éšæœºæ—¶é—´
                date.setHours(Math.floor(Math.random() * 24));
                date.setMinutes(Math.floor(Math.random() * 60));
                
                return date.toISOString();
            },

            // æ˜¾ç¤ºæ¨¡æ€æ¡†
            showModal(title, content) {
                const modal = document.createElement('div');
                modal.className = 'modal active';
                modal.innerHTML = `
                    <div class="modal-content">
                        <button class="modal-close" onclick="this.closest('.modal').remove()">Ã—</button>
                        <h2>${title}</h2>
                        ${content}
                    </div>
                `;
                document.body.appendChild(modal);
            },

            // æ˜¾ç¤ºé€šçŸ¥
            showNotification(message, type = 'success') {
                const notification = document.createElement('div');
                notification.style.cssText = `
                    position: fixed;
                    top: 20px;
                    right: 20px;
                    background: ${type === 'success' ? 'var(--primary-color)' : '#e74c3c'};
                    color: white;
                    padding: 15px 20px;
                    border-radius: 8px;
                    box-shadow: var(--shadow);
                    z-index: 10000;
                    animation: slideIn 0.3s ease;
                `;
                notification.textContent = message;
                document.body.appendChild(notification);

                setTimeout(() => {
                    notification.remove();
                }, 3000);
            }
        };

        // åˆå§‹åŒ–åº”ç”¨
        document.addEventListener('DOMContentLoaded', () => {
            app.init();
            
            // è‡ªåŠ¨åˆ·æ–°æ•°æ®åˆ†æé¡µé¢
            setInterval(() => {
                if (app.currentMerchantPage === 'analytics') {
                    app.renderAnalytics();
                    console.log('è‡ªåŠ¨åˆ·æ–°æ•°æ®åˆ†æ');
                }
            }, 30000); // æ¯30ç§’åˆ·æ–°ä¸€æ¬¡
        });

        // é”®ç›˜å¿«æ·é”®
        document.addEventListener('keydown', (e) => {
            // Ctrl+Shift+O æ‰“å¼€å•†å®¶æ¨¡å¼ï¼ˆå¼€å‘è€…å¿«æ·é”®ï¼‰
            if (e.ctrlKey && e.shiftKey && e.key === 'O') {
                e.preventDefault();
                document.querySelectorAll('.mode-btn')[1].click();
            }
        });
    </script>
</body>
</html>